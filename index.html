<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Stok Asistani</title>

<style>
body{
  margin:0;
  font-family:Arial,Helvetica,sans-serif;
  background:#0b1220;
  color:#e6f0ff;
  display:flex;
  justify-content:center;
}
.app{
  width:100%;
  max-width:520px;
  padding:20px;
}
h1{
  text-align:center;
  color:#38bdf8;
}
#mic{
  width:100px;height:100px;
  margin:20px auto;
  border-radius:50%;
  background:#0ea5e9;
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:46px;
  cursor:pointer;
}
#mic.listening{
  animation:pulse 1s infinite;
}
@keyframes pulse{
  0%{box-shadow:0 0 10px #38bdf8}
  50%{box-shadow:0 0 35px #38bdf8}
  100%{box-shadow:0 0 10px #38bdf8}
}
input{
  width:100%;
  padding:14px;
  border-radius:12px;
  border:none;
  font-size:16px;
}
#out{
  margin-top:15px;
  background:#020617;
  padding:15px;
  border-radius:12px;
  min-height:90px;
}
</style>
</head>

<body>
<div class="app">
<h1>ğŸ™ï¸ Stok Asistani</h1>

<div id="mic">ğŸ¤</div>

<input id="txt" placeholder="Stok kodu, Ã¼rÃ¼n adÄ± veya sohbet yaz..." />

<div id="out">HazÄ±rÄ±m.</div>
</div>

<script>
// ================== GOMULU VERI ==================
const RAW = `
MAMUL	00201306090	ACI BÄ°BER 100 LUK TÃœM  100 G ORTA PET (K332)
`;

const STOCKS = RAW.trim().split("\n").map(l=>{
  const p=l.split("\t");
  return { grup:p[0], kod:p[1], ad:p[2] };
});

// ================== SES ==================
function speak(t){
  const u=new SpeechSynthesisUtterance(t);
  u.lang="tr-TR";
  speechSynthesis.cancel();
  speechSynthesis.speak(u);
}

// ================== AKAN YAZI ==================
function type(text){
  out.innerText="";
  let i=0;
  const timer=setInterval(()=>{
    out.innerText+=text[i];
    i++;
    if(i>=text.length) clearInterval(timer);
  },20);
}

// ================== STOK OKUMA ==================
function readStockCode(code){
  let res=[];
  for(let i=0;i<code.length;i+=2){
    const g=code.substring(i,i+2);
    if(g[0]==="0") res.push("sÄ±fÄ±r "+digit(g[1]));
    else res.push(twoDigit(g));
  }
  return res.join(" , ");
}

function digit(d){
  return ["","bir","iki","Ã¼Ã§","dÃ¶rt","beÅŸ","altÄ±","yedi","sekiz","dokuz"][d];
}
function twoDigit(n){
  const t=["","on","yirmi","otuz","kÄ±rk","elli","altmÄ±ÅŸ","yetmiÅŸ","seksen","doksan"];
  return t[n[0]]+(n[1]!=="0"?" "+digit(n[1]]:"");
}

// ================== ANALIZ ==================
function analyze(q){
  q=q.toLowerCase();

  // sohbet
  if(q.includes("nasÄ±lsÄ±n")){
    type("Ä°yiyim, teÅŸekkÃ¼r ederim. Sana stok bilgisi vermek iÃ§in buradayÄ±m.");
    speak("Ä°yiyim, teÅŸekkÃ¼r ederim. Sana stok bilgisi vermek iÃ§in buradayÄ±m.");
    return;
  }

  // stok
  let found=null;
  STOCKS.forEach(s=>{
    if(q.includes(s.kod) || s.ad.toLowerCase().includes(q)){
      found=s;
    }
  });

  if(!found){
    type("EÅŸleÅŸme bulamadÄ±m. Tekrar dener misin?");
    speak("EÅŸleÅŸme bulamadÄ±m.");
    return;
  }

  const spokenCode = readStockCode(found.kod);
  const text = `${found.grup}. Stok kodu ${spokenCode}. ÃœrÃ¼n ${found.ad}.`;
  type(text);
  speak(text);
}

// ================== MANUEL ==================
txt.addEventListener("keydown",e=>{
  if(e.key==="Enter") analyze(e.target.value);
});

// ================== MIKROFON ==================
const SR = window.SpeechRecognition || window.webkitSpeechRecognition;
if(SR){
  const rec = new SR();
  rec.lang="tr-TR";
  mic.onclick=()=>{
    mic.classList.add("listening");
    rec.start();
  };
  rec.onresult=e=>{
    mic.classList.remove("listening");
    analyze(e.results[0][0].transcript);
  };
  rec.onerror=()=>{
    mic.classList.remove("listening");
    type("Mikrofon eriÅŸimi reddedildi. YazÄ± ile deneyebilirsin.");
  };
}
</script>
</body>
</html>
